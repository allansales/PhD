pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
return(w_dif_a_b)
}
dif_sim_table = create_dif_sim_table(x, y, a, b, folha_up_down)
dif_sim_table
score_permutacoes <- function(permutacao_table, dif_sim_table){
sum_w_sim = function(words_set, w_dif_a_b){
w_dif_a_b %>% filter(target %in% words_set) %>% summarise(sum_sim = sum(mean_cos)) %>% as.numeric()
}
score_Xi = permutacao_table$Xi %>% apply(1, sum_w_sim, dif_sim_table)
score_Yi = permutacao_table$Yi %>% apply(1, sum_w_sim, dif_sim_table)
score_Xi_Yi = score_Xi - score_Yi
return(bind_cols(permutacao_table$Xi, permutacao_table$Yi, score = score_Xi_Yi))
}
permutacao_table = permutacao(x, y)
score_permutacoes(permutacao_table, dif_sim_table)
score_permutacoes <- function(permutacao_table, dif_sim_table){
sum_w_sim = function(words_set, w_dif_a_b){
w_dif_a_b %>% filter(target %in% words_set) %>% summarise(sum_sim = sum(mean_cos)) %>% as.numeric()
}
score_Xi = permutacao_table$Xi %>% apply(1, sum_w_sim, dif_sim_table)
score_Yi = permutacao_table$Yi %>% apply(1, sum_w_sim, dif_sim_table)
score_Xi_Yi = score_Xi - score_Yi
return(bind_cols(permutacao_table$Xi, permutacao_table$Yi, score = score_Xi_Yi))
}
score_permutacoes(permutacao_table, dif_sim_table)
x
x_mean = dif_sim_table %>% filter(target %in% x) %>% mean()
x_mean
dif_sim_table
x_mean = dif_sim_table %>% filter(target %in% x)
x_mean
x_mean = dif_sim_table %>% filter(target %in% x) %>% mean(mean_cos)
x_mean
x_mean = dif_sim_table %>% filter(target %in% x) %>% summarise(mean_dif = mean(mean_cos))
x_mean
y_mean = dif_sim_table %>% filter(target %in% y) %>% summarise(mean_dif = mean(mean_cos)) %>% as.numeric()
y_mean
dif_sim_table
create_dif_sim_table <- function(x, y, a, b, modelo){ #tabela de diferenca de similaridades das palavras de x e y para os conjuntos a e b
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
w_dif_a_b = w_dif_a_b %>% rename(mean_cos = mean_dif_cos)
return(w_dif_a_b)
}
dif_sim_table = create_dif_sim_table(x, y, a, b, folha_up_down)
create_dif_sim_table <- function(x, y, a, b, modelo){ #tabela de diferenca de similaridades das palavras de x e y para os conjuntos a e b
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
w_dif_a_b = w_dif_a_b %>% rename(mean_dif_cos = mean_cos)
return(w_dif_a_b)
}
dif_sim_table = create_dif_sim_table(x, y, a, b, folha_up_down)
dif_sim_table
permutacao_table = permutacao(x, y)
score_permutacoes(permutacao_table, dif_sim_table)
score_permutacoes <- function(permutacao_table, dif_sim_table){
sum_w_sim = function(words_set, w_dif_a_b){
w_dif_a_b %>% filter(target %in% words_set) %>% summarise(sum_sim = sum(mean_dif_cos)) %>% as.numeric()
}
score_Xi = permutacao_table$Xi %>% apply(1, sum_w_sim, dif_sim_table)
score_Yi = permutacao_table$Yi %>% apply(1, sum_w_sim, dif_sim_table)
score_Xi_Yi = score_Xi - score_Yi
return(bind_cols(permutacao_table$Xi, permutacao_table$Yi, score = score_Xi_Yi))
}
score_permutacoes(permutacao_table, dif_sim_table)
x_mean = dif_sim_table %>% filter(target %in% x) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
y_mean = dif_sim_table %>% filter(target %in% y) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
x_mean
y_mean
w_sd = dif_sim_table %>% summarise(sd = sd(mean_dif_cos)) %>% as.numeric()
w_sd
(x_mean - y_mean)/w_sd
effect_size <- function(x, y, dif_sim_table, modelo){
x_mean = dif_sim_table %>% filter(target %in% x) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
y_mean = dif_sim_table %>% filter(target %in% y) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
w_sd = dif_sim_table %>% summarise(sd = sd(mean_dif_cos)) %>% as.numeric()
return((x_mean - y_mean)/w_sd)
}
scores_permutacao = score_permutacoes(permutacao_table, dif_sim_table)
effect_size <- function(x, y, dif_sim_table){
x_mean = dif_sim_table %>% filter(target %in% x) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
y_mean = dif_sim_table %>% filter(target %in% y) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
w_sd = dif_sim_table %>% summarise(sd = sd(mean_dif_cos)) %>% as.numeric()
return((x_mean - y_mean)/w_sd)
}
tam_efeito = effect_size(x, y, dif_sim_table)
tam_efeito
dif_sim_table
tabela_distancias <- function(){
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
return(pares)
}
create_dif_sim_table <- function(x, y, a, b, modelo){ #tabela de diferenca de similaridades das palavras de x e y para os conjuntos a e b
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
w_dif_a_b = w_dif_a_b %>% rename(mean_dif_cos = mean_cos)
return(list(dif_sim_table = w_dif_a_b, w_cos_dist = pares))
}
create_dif_sim_table <- function(x, y, a, b, modelo){ #tabela de diferenca de similaridades das palavras de x e y para os conjuntos a e b
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
w_dif_a_b = w_dif_a_b %>% rename(mean_dif_cos = mean_cos)
return(list(dif_sim_table = w_dif_a_b, w_cos_dist = pares))
}
dif_sim_table = create_dif_sim_table(x, y, a, b, folha_up_down)
dif_sim_table
create_cosine_metrics <- function(x, y, a, b, modelo){ #tabela de diferenca de similaridades das palavras de x e y para os conjuntos a e b
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
w_dif_a_b = w_dif_a_b %>% rename(mean_dif_cos = mean_cos)
return(list(dif_sim_table = w_dif_a_b, w_cos_dist = pares))
}
dif_sim_table = create_cosine_metrics(x, y, a, b, folha_up_down)
cosine_metrics = create_cosine_metrics(x, y, a, b, folha_up_down)
dif_sim_table = cosine_metrics$dif_sim_table
w_cos_dist = cosine_metrics$w_cos_dist
scores_permutacao = score_permutacoes(permutacao_table, dif_sim_table)
tam_efeito = effect_size(x, y, dif_sim_table)
w_cos_dist
View(w_cos_dist)
w_sd = w_cos_dist %>% group_by(target) %>% summarise(sd = sd(cos_sim))
w_sd
dif_sim_table
w_sd = w_cos_dist %>% group_by(target) %>% summarise(sd = sd(cos_sim)) %>% arrange(target)
dif_sim_table = dif_sim_table %>% arrange(target)
dif_sim_table
w_sd
w_sd
w_wefat = bind_cols(dif_sim_table %>% select(target),
dif_sim_table %>% select(mean_dif_cos)/
w_sd %>% select(sd))
w_wefat
dif_sim_table
w_sd
0.031379098/0.05974208
w_wefat
wefat <- function(dif_sim_table, w_cos_dist){
dif_sim_table = dif_sim_table %>% arrange(target)
w_sd = w_cos_dist %>% group_by(target) %>% summarise(sd = sd(cos_sim)) %>% arrange(target)
w_wefat = bind_cols(dif_sim_table %>% select(target),
dif_sim_table %>% select(mean_dif_cos)/
w_sd %>% select(sd))
return(w_wefat)
}
scores_permutacao
View(scores_permutacao)
x
y
knitr::opts_chunk$set(echo = TRUE)
library(wordVectors)
folha_up = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_up.bin")
folha_up = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_up.bin")
folha_down = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_down.bin")
folha_up_down = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_up_down.bin")
x = c("aécio", "neves", "fhc", "psdb", "aloysio")
y = c("dilma", "rousseff", "lula", "pt", "temer")
a = c("carinho", "liberdade", "saúde", "amor", "paz", "alegria", "fiel", "honesto", "sorte", "diploma", "presente", "honra", "família", "feliz", "férias")
b = c("abuso", "quebra", "doença", "acidente", "sofrimento", "assalto", "desastre", "ódio", "tragédia", "cadeia", "pobreza", "feio", "câncer", "morte", "prisão")
cosSim_model <- function(w1, w2, modelo){
cosineSimilarity(modelo[[w1]],modelo[[w2]]) %>% as.numeric()
}
create_cosine_metrics <- function(x, y, a, b, modelo){ #tabela de diferenca de similaridades das palavras de x e y para os conjuntos a e b
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
w_dif_a_b = w_dif_a_b %>% rename(mean_dif_cos = mean_cos)
return(list(dif_sim_table = w_dif_a_b, w_cos_dist = pares))
}
permutacao <- function(x, y){
remove_repeated_sets = function(Xi, Yi){
duplicados = duplicated(Yi)
Xi = Xi[!duplicados,]
Yi = Yi[!duplicados,]
return(list(Xi = Xi, Yi = Yi))
}
all_targets = c(x,y)
n = length(all_targets)
Xi = permutations(n=n, r=n/2, v=all_targets) %>% as.data.frame()
colnames(Xi) = paste("X",colnames(Xi),sep = "")
Yi = Xi %>% apply(1, FUN=function(x){
setdiff(all_targets, x)
}) %>% t() %>% as.data.frame()
colnames(Yi) = paste("Y",colnames(Yi),sep = "")
return(remove_repeated_sets(Xi, Yi))
}
score <- function(tables, dif_sim_table){
sum_w_sim = function(words_set, dif_sim_table){
dif_sim_table %>% filter(target %in% words_set) %>% summarise(sum_sim = sum(mean_dif_cos)) %>% as.numeric()
}
score_Xi = tables$Xi %>% apply(1, sum_w_sim, dif_sim_table)
score_Yi = tables$Yi %>% apply(1, sum_w_sim, dif_sim_table)
score_Xi_Yi = score_Xi - score_Yi
return(bind_cols(tables$Xi, tables$Yi, score = score_Xi_Yi))
}
effect_size <- function(x, y, dif_sim_table){
x_mean = dif_sim_table %>% filter(target %in% x) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
y_mean = dif_sim_table %>% filter(target %in% y) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
w_sd = dif_sim_table %>% summarise(sd = sd(mean_dif_cos)) %>% as.numeric()
return((x_mean - y_mean)/w_sd)
}
wefat <- function(dif_sim_table, w_cos_dist){
dif_sim_table = dif_sim_table %>% arrange(target)
w_sd = w_cos_dist %>% group_by(target) %>% summarise(sd = sd(cos_sim)) %>% arrange(target)
w_wefat = bind_cols(dif_sim_table %>% select(target),
dif_sim_table %>% select(mean_dif_cos)/
w_sd %>% select(sd))
return(w_wefat)
}
permutacao_table = permutacao(x, y)
cosine_metrics = create_cosine_metrics(x, y, a, b, folha_up_down)
dif_sim_table = cosine_metrics$dif_sim_table
w_cos_dist = cosine_metrics$w_cos_dist
scores_permutacao = score_permutacoes(permutacao_table, dif_sim_table)
scores_permutacao = score(permutacao_table, dif_sim_table)
tam_efeito = effect_size(x, y, dif_sim_table)
tam_efeito
w_wefat = wefat(dif_sim_table, w_cos_dist)
w_wefat
s = score(tables, dif_sim_table)
tables = list(x = x, y = y)
s = score(tables, dif_sim_table)
tables
table = list(Xi = x, Yi = y)
table
s = score(table, dif_sim_table)
table = list(Xi = data_frame(x), Yi = data_frame(y))
s = score(table, dif_sim_table)
s
table = list(Xi = data_frame(x = x), Yi = data_frame(y = y))
table
table = list(Xi = data_frame(x) %>% t(), Yi = data_frame(y) %>% t())
table
s = score(table, dif_sim_table)
data_frame(x) %>% t()
x %>% t()
data_frame(x %>% t())
x %>% t()
x %>% t() %>% as_data_frame()
Xi = x %>% t() %>% as_data_frame()
Yi = y %>% t() %>% as_data_frame()
table = list(Xi = Xi, Yi = Yi)
table = list(Xi = Xi, Yi = Yi)
table
s = score(table, dif_sim_table)
s
View(scores_permutacao)
0.0408939241
0.04089392
38/252
View(s)
X = x %>% t() %>% as_data_frame()
Y = y %>% t() %>% as_data_frame()
table = list(Xi = X, Yi = Y)
score_x_y = score(table, dif_sim_table)
score_x_y
tbl = data_frame(value = scores_permutacao$score > score_x_y$score)
tbl
n_true = tbl %>% filter(value == T) %>% summarise(cont = n()-1) %>% as.numeric()
n_true
n_total = nrow(tbl)
n_total
n_true/n_total
n_true = tbl %>% filter(value == T) %>% summarise(cont = n()) %>% as.numeric()
n_total = nrow(tbl)
n_true/n_total
View(scores_permutacao)
score_x_y$score
scores_permutacao$score > score_x_y$score
table(scores_permutacao$score > score_x_y$score)
scores_permutacao$score
View(scores_permutacao)
q = scores_permutacao[scores_permutacao$score > score_x_y$score]
q = scores_permutacao[scores_permutacao$score > score_x_y$score,]
View(q)
score_x_y$score
View(q)
pvalor <- function(x, y, scores_permutacao, dif_sim_table){
X = x %>% t() %>% as_data_frame()
Y = y %>% t() %>% as_data_frame()
table = list(Xi = X, Yi = Y)
score_x_y = score(table, dif_sim_table)
tbl = data_frame(value = scores_permutacao$score > score_x_y$score)
n_true = tbl %>% filter(value == T) %>% summarise(cont = n()-1) %>% as.numeric() #menos 1 porque uma das linhas do denominador tera o mesmo valor que score_x_y$score
n_total = nrow(tbl)
return(n_true/n_total)
}
library(wordVectors)
folha_up = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_up.bin")
folha_up = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_up.bin")
folha_down = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_down.bin")
folha_up_down = read.binary.vectors("../word_embeddings/vieses_em_comentarios/embeddings/folha_thumbs_up_down.bin")
library("dplyr")
library("wordVectors")
library("partitions")
library("gtools")
library("purrr")
cosSim_model <- function(w1, w2, modelo){
cosineSimilarity(modelo[[w1]],modelo[[w2]]) %>% as.numeric()
}
create_cosine_metrics <- function(x, y, a, b, modelo){ #tabela de diferenca de similaridades das palavras de x e y para os conjuntos a e b
targets = c(x, y)
features = c(a, b)
pares = expand.grid(target = targets, feature = features)
pares$target = pares$target %>% as.character()
pares$feature = pares$feature %>% as.character()
pares = pares %>%
rowwise() %>%
mutate(cos_sim = cosSim_model(target, feature, modelo))
targets_a = pares %>% filter(feature %in% a)
targets_b = pares %>% filter(feature %in% b)
w_sim_a = targets_a %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_sim_b = targets_b %>% group_by(target) %>% summarise(mean_cos = mean(cos_sim)) %>% arrange(target)
w_dif_a_b = bind_cols(w_sim_a %>% select(target), #poderia usar w_sim_b. as duas terao a mesma ordem
(w_sim_a %>% select(mean_cos) -
w_sim_b %>% select(mean_cos)))
w_dif_a_b = w_dif_a_b %>% rename(mean_dif_cos = mean_cos)
return(list(dif_sim_table = w_dif_a_b, w_cos_dist = pares))
}
permutacao <- function(x, y){
remove_repeated_sets = function(Xi, Yi){
duplicados = duplicated(Yi)
Xi = Xi[!duplicados,]
Yi = Yi[!duplicados,]
return(list(Xi = Xi, Yi = Yi))
}
all_targets = c(x,y)
n = length(all_targets)
Xi = permutations(n=n, r=n/2, v=all_targets) %>% as.data.frame()
colnames(Xi) = paste("X",colnames(Xi),sep = "")
Yi = Xi %>% apply(1, FUN=function(x){
setdiff(all_targets, x)
}) %>% t() %>% as.data.frame()
colnames(Yi) = paste("Y",colnames(Yi),sep = "")
return(remove_repeated_sets(Xi, Yi))
}
score <- function(tables, dif_sim_table){
sum_w_sim = function(words_set, dif_sim_table){
dif_sim_table %>% filter(target %in% words_set) %>% summarise(sum_sim = sum(mean_dif_cos)) %>% as.numeric()
}
score_Xi = tables$Xi %>% apply(1, sum_w_sim, dif_sim_table)
score_Yi = tables$Yi %>% apply(1, sum_w_sim, dif_sim_table)
score_Xi_Yi = score_Xi - score_Yi
return(bind_cols(tables$Xi, tables$Yi, score = score_Xi_Yi))
}
pvalor <- function(x, y, scores_permutacao, dif_sim_table){
X = x %>% t() %>% as_data_frame()
Y = y %>% t() %>% as_data_frame()
table = list(Xi = X, Yi = Y)
score_x_y = score(table, dif_sim_table)
tbl = data_frame(value = scores_permutacao$score > score_x_y$score)
n_true = tbl %>% filter(value == T) %>% summarise(cont = n()-1) %>% as.numeric() #menos 1 porque uma das linhas do denominador tera o mesmo valor que score_x_y$score
n_total = nrow(tbl)
return(n_true/n_total)
}
effect_size <- function(x, y, dif_sim_table){
x_mean = dif_sim_table %>% filter(target %in% x) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
y_mean = dif_sim_table %>% filter(target %in% y) %>% summarise(mean_dif = mean(mean_dif_cos)) %>% as.numeric()
w_sd = dif_sim_table %>% summarise(sd = sd(mean_dif_cos)) %>% as.numeric()
return((x_mean - y_mean)/w_sd)
}
wefat <- function(dif_sim_table, w_cos_dist){
dif_sim_table = dif_sim_table %>% arrange(target)
w_sd = w_cos_dist %>% group_by(target) %>% summarise(sd = sd(cos_sim)) %>% arrange(target)
w_wefat = bind_cols(dif_sim_table %>% select(target),
dif_sim_table %>% select(mean_dif_cos)/
w_sd %>% select(sd))
return(w_wefat)
}
x = c("aécio", "neves", "fhc", "psdb", "aloysio")
y = c("dilma", "rousseff", "lula", "pt", "temer")
a = c("carinho", "liberdade", "saúde", "amor", "paz", "alegria", "fiel", "honesto", "sorte", "diploma", "presente", "honra", "família", "feliz", "férias")
b = c("abuso", "quebra", "doença", "acidente", "sofrimento", "assalto", "desastre", "ódio", "tragédia", "cadeia", "pobreza", "feio", "câncer", "morte", "prisão")
permutacao_table = permutacao(x, y)
cosine_metrics = create_cosine_metrics(x, y, a, b, folha_up_down)
dif_sim_table = cosine_metrics$dif_sim_table
w_cos_dist = cosine_metrics$w_cos_dist
scores_permutacao = score(permutacao_table, dif_sim_table)
tam_efeito = effect_size(x, y, dif_sim_table)
pvalor = p_valor(x, y, scores_permutacao, dif_sim_table)
w_wefat = wefat(dif_sim_table, w_cos_dist)
p_valor = pvalor(x, y, scores_permutacao, dif_sim_table)
w_wefat = wefat(dif_sim_table, w_cos_dist)
permutacao_table = permutacao(x, y)
cosine_metrics = create_cosine_metrics(x, y, a, b, folha_up_down)
dif_sim_table = cosine_metrics$dif_sim_table
w_cos_dist = cosine_metrics$w_cos_dist
scores_permutacao = score(permutacao_table, dif_sim_table)
tam_efeito = effect_size(x, y, dif_sim_table)
p_valor = pvalor(x, y, scores_permutacao, dif_sim_table)
w_wefat = wefat(dif_sim_table, w_cos_dist)
w_wefat
p_valor
tam_efeito
scores_permutacao
w_cos_dist
dif_sim_table
cosine_metrics
permutacao_table
x = c("dilma", "genro", "marina", "marta", "erundina", "rosário")
y = c("aécio", "lula", "fhc", "cunha", "temer", "bolsonaro")
a = c("pt", "psb", "psd", "pdt", "pps", "pcdob", "psol")
b = c("pp", "pr", "prb", "pros", "phs", "pen", "dem")
permutacao_table = permutacao(x, y)
cosine_metrics = create_cosine_metrics(x, y, a, b, folha_up_down)
dif_sim_table = cosine_metrics$dif_sim_table
w_cos_dist = cosine_metrics$w_cos_dist
scores_permutacao = score(permutacao_table, dif_sim_table)
tam_efeito = effect_size(x, y, dif_sim_table)
p_valor = pvalor(x, y, scores_permutacao, dif_sim_table)
w_wefat = wefat(dif_sim_table, w_cos_dist)
w_wefat
p_valor
tam_efeito
scores_permutacao
w_cos_dist
dif_sim_table
cosine_metrics
